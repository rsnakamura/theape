<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>paramiko.hostkeys &mdash; The Ape 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.3.4/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The Ape 0.0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          The Ape</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/user/index.html">User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation/developer/index.html">Developer Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../log_setter.html">Log Setter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../main.html">The Main Entry Point</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">The APE (Read Me)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../components/index.html">The Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">The Ape&#8217;s Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parts/index.html">Parts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <h1>Source code for paramiko.hostkeys</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2006-2007  Robey Pointer &lt;robeypointer@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># This file is part of paramiko.</span>
<span class="c1">#</span>
<span class="c1"># Paramiko is free software; you can redistribute it and/or modify it under the</span>
<span class="c1"># terms of the GNU Lesser General Public License as published by the Free</span>
<span class="c1"># Software Foundation; either version 2.1 of the License, or (at your option)</span>
<span class="c1"># any later version.</span>
<span class="c1">#</span>
<span class="c1"># Paramiko is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="c1"># WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR</span>
<span class="c1"># A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more</span>
<span class="c1"># details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Paramiko; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA.</span>


<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha1</span>
<span class="kn">from</span> <span class="nn">hmac</span> <span class="kn">import</span> <span class="n">HMAC</span>

<span class="kn">from</span> <span class="nn">paramiko.py3compat</span> <span class="kn">import</span> <span class="n">b</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">encodebytes</span><span class="p">,</span> <span class="n">decodebytes</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># noinspection PyUnresolvedReferences</span>
    <span class="kn">from</span> <span class="nn">UserDict</span> <span class="kn">import</span> <span class="n">DictMixin</span> <span class="k">as</span> <span class="n">MutableMapping</span>

<span class="kn">from</span> <span class="nn">paramiko.dsskey</span> <span class="kn">import</span> <span class="n">DSSKey</span>
<span class="kn">from</span> <span class="nn">paramiko.rsakey</span> <span class="kn">import</span> <span class="n">RSAKey</span>
<span class="kn">from</span> <span class="nn">paramiko.util</span> <span class="kn">import</span> <span class="n">get_logger</span><span class="p">,</span> <span class="n">constant_time_bytes_eq</span>
<span class="kn">from</span> <span class="nn">paramiko.ecdsakey</span> <span class="kn">import</span> <span class="n">ECDSAKey</span>
<span class="kn">from</span> <span class="nn">paramiko.ssh_exception</span> <span class="kn">import</span> <span class="n">SSHException</span>


<div class="viewcode-block" id="HostKeys"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys">[docs]</a><span class="k">class</span> <span class="nc">HostKeys</span> <span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of an OpenSSH-style &quot;known hosts&quot; file.  Host keys can be</span>
<span class="sd">    read from one or more files, and then individual hosts can be looked up to</span>
<span class="sd">    verify server keys during SSH negotiation.</span>

<span class="sd">    A `.HostKeys` object can be treated like a dict; any dict lookup is</span>
<span class="sd">    equivalent to calling `lookup`.</span>

<span class="sd">    .. versionadded:: 1.5.3</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="HostKeys.__init__"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new HostKeys object, optionally loading keys from an OpenSSH</span>
<span class="sd">        style host-key file.</span>

<span class="sd">        :param str filename: filename to load host keys from, or ``None``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># emulate a dict of { hostname: { keytype: PKey } }</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostKeys.add"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">keytype</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a host key entry to the table.  Any existing entry for a</span>
<span class="sd">        ``(hostname, keytype)`` pair will be replaced.</span>

<span class="sd">        :param str hostname: the hostname (or IP) to add</span>
<span class="sd">        :param str keytype: key type (``&quot;ssh-rsa&quot;`` or ``&quot;ssh-dss&quot;``)</span>
<span class="sd">        :param .PKey key: the key to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hostname</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">hostnames</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">keytype</span><span class="p">):</span>
                <span class="n">e</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HostKeyEntry</span><span class="p">([</span><span class="n">hostname</span><span class="p">],</span> <span class="n">key</span><span class="p">))</span></div>

<div class="viewcode-block" id="HostKeys.load"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a file of known SSH host keys, in the format used by OpenSSH.</span>
<span class="sd">        This type of file unfortunately doesn&#39;t exist on Windows, but on</span>
<span class="sd">        posix, it will usually be stored in</span>
<span class="sd">        ``os.path.expanduser(&quot;~/.ssh/known_hosts&quot;)``.</span>

<span class="sd">        If this method is called multiple times, the host keys are merged,</span>
<span class="sd">        not cleared.  So multiple calls to `load` will just call `add`,</span>
<span class="sd">        replacing any existing entries and adding new ones.</span>

<span class="sd">        :param str filename: name of the file to read host keys from</span>

<span class="sd">        :raises IOError: if there was an error reading the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">HostKeyEntry</span><span class="o">.</span><span class="n">from_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">SSHException</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">e</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">_hostnames</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">hostnames</span>
                    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">_hostnames</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
                            <span class="n">e</span><span class="o">.</span><span class="n">hostnames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">hostnames</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostKeys.save"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save host keys into a file, in the format used by OpenSSH.  The order of</span>
<span class="sd">        keys in the file will be preserved when possible (if these keys were</span>
<span class="sd">        loaded from a file originally).  The single exception is that combined</span>
<span class="sd">        lines will be split into individual key lines, which is arguably a bug.</span>

<span class="sd">        :param str filename: name of the file to write</span>

<span class="sd">        :raises IOError: if there was an error writing the file</span>

<span class="sd">        .. versionadded:: 1.6.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">to_line</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostKeys.lookup"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.lookup">[docs]</a>    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a hostkey entry for a given hostname or IP.  If no entry is found,</span>
<span class="sd">        ``None`` is returned.  Otherwise a dictionary of keytype to key is</span>
<span class="sd">        returned.  The keytype will be either ``&quot;ssh-rsa&quot;`` or ``&quot;ssh-dss&quot;``.</span>

<span class="sd">        :param str hostname: the hostname (or IP) to lookup</span>
<span class="sd">        :return: dict of `str` -&gt; `.PKey` keys associated with this host (or ``None``)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">class</span> <span class="nc">SubDict</span> <span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="n">hostkeys</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="n">hostname</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="n">entries</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hostkeys</span> <span class="o">=</span> <span class="n">hostkeys</span>

            <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">yield</span> <span class="n">k</span>

            <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                        <span class="c1"># replace</span>
                        <span class="n">e</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># add a new one</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">HostKeyEntry</span><span class="p">([</span><span class="n">hostname</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_hostkeys</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">hostnames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;|1|&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hostname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;|1|&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">constant_time_bytes_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_host</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">h</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">==</span> <span class="n">hostname</span><span class="p">:</span>
                    <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">SubDict</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="HostKeys.check"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if the given key is associated with the given hostname</span>
<span class="sd">        in this dictionary.</span>

<span class="sd">        :param str hostname: hostname (or IP) of the SSH server</span>
<span class="sd">        :param .PKey key: the key to check</span>
<span class="sd">        :return:</span>
<span class="sd">            ``True`` if the key is associated with the hostname; else ``False``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">host_key</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">host_key</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="n">host_key</span><span class="o">.</span><span class="n">asbytes</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">asbytes</span><span class="p">()</span></div>

<div class="viewcode-block" id="HostKeys.clear"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all host keys from the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="c1"># don&#39;t use this please.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HostKeyEntry</span><span class="p">([</span><span class="n">hostname</span><span class="p">],</span> <span class="bp">None</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">key_type</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hostname</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">hostnames</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">==</span> <span class="n">key_type</span><span class="p">):</span>
                    <span class="c1"># replace</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="n">key_type</span><span class="p">]</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HostKeyEntry</span><span class="p">([</span><span class="n">hostname</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="n">key_type</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Python 2.4 sets would be nice here.</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">e</span><span class="o">.</span><span class="n">hostnames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="HostKeys.hash_host"><a class="viewcode-back" href="../../documentation/developer/explorations/explore_paramiko/api/paramiko.hostkeys.HostKeys.html#paramiko.hostkeys.HostKeys.hash_host">[docs]</a>    <span class="k">def</span> <span class="nf">hash_host</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">salt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a &quot;hashed&quot; form of the hostname, as used by OpenSSH when storing</span>
<span class="sd">        hashed hostnames in the known_hosts file.</span>

<span class="sd">        :param str hostname: the hostname to hash</span>
<span class="sd">        :param str salt: optional salt to use when hashing (must be 20 bytes long)</span>
<span class="sd">        :return: the hashed hostname as a `str`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">salt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">salt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">sha1</span><span class="p">()</span><span class="o">.</span><span class="n">digest_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">salt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;|1|&#39;</span><span class="p">):</span>
                <span class="n">salt</span> <span class="o">=</span> <span class="n">salt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">salt</span> <span class="o">=</span> <span class="n">decodebytes</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">salt</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">salt</span><span class="p">)</span> <span class="o">==</span> <span class="n">sha1</span><span class="p">()</span><span class="o">.</span><span class="n">digest_size</span>
        <span class="n">hmac</span> <span class="o">=</span> <span class="n">HMAC</span><span class="p">(</span><span class="n">salt</span><span class="p">,</span> <span class="n">b</span><span class="p">(</span><span class="n">hostname</span><span class="p">),</span> <span class="n">sha1</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
        <span class="n">hostkey</span> <span class="o">=</span> <span class="s1">&#39;|1|</span><span class="si">%s</span><span class="s1">|</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">salt</span><span class="p">)),</span> <span class="n">u</span><span class="p">(</span><span class="n">encodebytes</span><span class="p">(</span><span class="n">hmac</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">hostkey</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">InvalidHostKey</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exc</span> <span class="o">=</span> <span class="n">exc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HostKeyEntry</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representation of a line in an OpenSSH-style &quot;known hosts&quot; file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostnames</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="p">(</span><span class="n">hostnames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span> <span class="o">=</span> <span class="n">hostnames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_line</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">lineno</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the given line of text to find the names for the host,</span>
<span class="sd">        the type of key, and the key data. The line is expected to be in the</span>
<span class="sd">        format used by the OpenSSH known_hosts file.</span>

<span class="sd">        Lines are expected to not have leading or trailing whitespace.</span>
<span class="sd">        We don&#39;t bother to check for comments or empty lines.  All of</span>
<span class="sd">        that should be taken care of before sending the line to us.</span>

<span class="sd">        :param str line: a line from an OpenSSH known_hosts file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s1">&#39;paramiko.hostkeys&#39;</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Bad number of fields</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Not enough fields found in known_hosts in line </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span>
                     <span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">names</span><span class="p">,</span> <span class="n">keytype</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">fields</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="c1"># Decide what kind of key we&#39;re looking at and create an object</span>
        <span class="c1"># to hold it accordingly.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">b</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">keytype</span> <span class="o">==</span> <span class="s1">&#39;ssh-rsa&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">RSAKey</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decodebytes</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">keytype</span> <span class="o">==</span> <span class="s1">&#39;ssh-dss&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">DSSKey</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decodebytes</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">keytype</span> <span class="o">==</span> <span class="s1">&#39;ecdsa-sha2-nistp256&#39;</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">ECDSAKey</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">decodebytes</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">validate_point</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to handle key of type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">keytype</span><span class="p">,))</span>
                <span class="k">return</span> <span class="bp">None</span>

        <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidHostKey</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a string in OpenSSH known_hosts file format, or None if</span>
<span class="sd">        the object is not in a valid state.  A trailing newline is</span>
<span class="sd">        included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_base64</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;HostKeyEntry </span><span class="si">%r</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, the cloistered monkey.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>