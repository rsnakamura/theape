<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>An Exec Command Example &mdash; The Ape 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.2.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The Ape 0.0.1 documentation" href="../../../../index.html" />
    <link rel="up" title="Exploring Paramiko" href="index.html" />
    <link rel="next" title="paramiko.client.SSHClient.exec_command" href="api/paramiko.client.SSHClient.exec_command.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html">
          The Ape</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Developer Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../log_setter.html">Log Setter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../main.html">The Main Entry Point</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../readme.html">The APE (Read Me)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../components/index.html">The Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infrastructure/index.html">The Ape&#8217;s Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../parts/index.html">Parts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../plugins/index.html">Plugins</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">An Exec Command Example</a><ul>
<li><a class="reference internal" href="#the-sshclient-exec-command">The SSHClient exec_command</a></li>
<li><a class="reference internal" href="#nmap">nmap</a></li>
<li><a class="reference internal" href="#nmap-with-sudo">nmap with sudo</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="api/paramiko.client.SSHClient.exec_command.html" title="Next Chapter: paramiko.client.SSHClient.exec_command"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">paramiko.client.... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../../../_sources/documentation/developer/explorations/explore_paramiko/exploring_exec_command.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="an-exec-command-example">
<h1>An Exec Command Example<a class="headerlink" href="#an-exec-command-example" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-sshclient-exec-command">
<span id="paramiko-sshclient-exec-command"></span><h2>The SSHClient exec_command<a class="headerlink" href="#the-sshclient-exec-command" title="Permalink to this headline">¶</a></h2>
<p>Now that I&#8217;ve managed to get a connection going it&#8217;s time to turn my attenttion to actually doing things on the machine. Paramiko has two ways to work with the shell &#8211; interactively using <tt class="docutils literal"><span class="pre">invoke_shell</span></tt> and non-interactively using <tt class="docutils literal"><span class="pre">exec_command</span></tt>. Since my intention is to use this within code I will focus on the <tt class="docutils literal"><span class="pre">exec_command</span></tt> method.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="../../../../parts/connections/api/paramiko.client.SSHClient.exec_command.html#paramiko.client.SSHClient.exec_command" title="paramiko.client.SSHClient.exec_command"><tt class="xref py py-obj docutils literal"><span class="pre">SSHClient.exec_command</span></tt></a>(command[,&nbsp;bufsize,&nbsp;...])</td>
<td>Execute a command on the SSH server.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../../../../parts/connections/api/paramiko.client.SSHClient.html#paramiko.client.SSHClient.invoke_shell" title="paramiko.client.SSHClient.invoke_shell"><tt class="xref py py-obj docutils literal"><span class="pre">SSHClient.invoke_shell</span></tt></a>([term,&nbsp;width,&nbsp;...])</td>
<td>Start an interactive shell session on the SSH server.</td>
</tr>
</tbody>
</table>
<p>There&#8217;s a few things of interest to note. One is that they&#8217;ve added a timeout so there&#8217;s no need to sub-class it and add your own to get a timeout (assuming that what it&#8217;s there for). The second thing to note is that it raises a <cite>paramiko.SSHException</cite> if the server fails to execute the command. Does this mean all errors? What if it&#8217;s a connectivity problem, does it raise this instead of a <cite>socket.error</cite>? The third (and probably most immediately useful) thing to note is that what you get back is a tuple of (<cite>stdin</cite>, <cite>stdout</cite>, <cite>stderr</cite>). It&#8217;s important to note the ordering of the returned tuples, as mixing them up will produce unpredictable results (I had standard out and standard in switched in one of the earlier examples and got an <cite>IOError</cite> when I tried to read from standard in &#8211; the error said that the file was closed, which might make sense if you know that I was trying to read from standard in, but it took me a little while to figure it out).</p>
</div>
<div class="section" id="nmap">
<span id="paramiko-exploration-nmap"></span><h2>nmap<a class="headerlink" href="#nmap" title="Permalink to this headline">¶</a></h2>
<p>I want to see if paramiko will allow me to run commands as sudo. Since <cite>nmap</cite> will change its behavior (adding MAC addresses) if you run the ping-scan using <cite>sudo</cite> I can run it with and without root privileges and see if I get the expected output.</p>
<div class="code python highlight-python"><div class="highlight"><pre>client = SSHClient()
client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
client.connect(&#39;localhost&#39;, username=&#39;tester_tester&#39;)
stdin, stdout, stderr = client.exec_command(&quot;nmap -sP &#39;192.168.103.*&#39;&quot;)
for line in stdout:
    print(line, end=&#39;&#39;)
</pre></div>
</div>
<div class="code highlight-python"><div class="highlight"><pre>Starting Nmap 6.40 ( http://nmap.org ) at 2015-01-22 15:29 MST
Nmap scan report for 192.168.103.1
Host is up (0.018s latency).
Nmap scan report for 192.168.103.16
Host is up (0.00035s latency).
Nmap done: 256 IP addresses (2 hosts up) scanned in 2.54 seconds
</pre></div>
</div>
</div>
<div class="section" id="nmap-with-sudo">
<h2>nmap with sudo<a class="headerlink" href="#nmap-with-sudo" title="Permalink to this headline">¶</a></h2>
<p>And now with sudo.</p>
<div class="code python highlight-python"><div class="highlight"><pre>stdin, stdout, stderr = client.exec_command(&#39;sudo nmap -sP &quot;192.168.103.*&quot;&#39;, get_pty=True)
stdin.write(&#39;testertester\n&#39;)
for line in stdout:
    print(line, end=&#39;&#39;)
</pre></div>
</div>
<div class="code highlight-python"><div class="highlight"><pre>testertester
[sudo] password for tester_tester:

Starting Nmap 6.40 ( http://nmap.org ) at 2015-01-22 15:29 MST
Nmap scan report for 192.168.103.1
Host is up (0.0031s latency).
Nmap scan report for 192.168.103.16
Host is up (0.051s latency).
Nmap done: 256 IP addresses (2 hosts up) scanned in 6.65 seconds
</pre></div>
</div>
<p>Two things to note &#8211; one is that I didn&#8217;t need to call the load_system_host_keys. It seems that the AutoAddPolicy takes care of that. The other thing to note is that I needed to set <cite>get_pty</cite> to True. If I didn&#8217;t it would close the channel with this error (on my machine):</p>
<div class="highlight-python"><div class="highlight"><pre>sudo: no tty present and no askpass program specified
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <tt class="docutils literal"><span class="pre">testertester</span></tt> line above <tt class="docutils literal"><span class="pre">[sudo]</span> <span class="pre">password</span> <span class="pre">for</span> <span class="pre">tester_tester:</span></tt> is the actual password that I entered so if you use this method the sudoer&#8217;s password will be visible in the output.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, the cloistered monkey.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>