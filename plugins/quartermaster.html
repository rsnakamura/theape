<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The QuarterMaster &mdash; The Ape 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="The Ape 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Plugins" href="index.html" />
    <link rel="next" title="theape.plugins.quartermaster.QuarterMaster" href="api/theape.plugins.quartermaster.QuarterMaster.html" />
    <link rel="prev" title="theape.parts.dummy.dummy.HangingDummy.__call__" href="api/theape.parts.dummy.dummy.HangingDummy.__call__.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api/theape.plugins.quartermaster.QuarterMaster.html" title="theape.plugins.quartermaster.QuarterMaster"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api/theape.parts.dummy.dummy.HangingDummy.__call__.html" title="theape.parts.dummy.dummy.HangingDummy.__call__"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Ape Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Plugins</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-theape.plugins.quartermaster">
<span id="the-quartermaster"></span><h1>The QuarterMaster<a class="headerlink" href="#module-theape.plugins.quartermaster" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Quartermaster">QuarterMaster</a> handles finding and interacting with the plugins.</p>
<p class="plantuml">
<img src="../_images/plantuml-28a85c3086bab1615f1585ddbe0b46e140d5ac78.png" alt="BaseClass &lt;|-- QuarterMaster
QuarterMaster o- RyeMother" />
</p>
<div class="section" id="public-methods-and-properties">
<span id="ape-plugins-quartermaster"></span><h2>Public Methods and Properties<a class="headerlink" href="#public-methods-and-properties" title="Permalink to this headline">¶</a></h2>
<p>These are the public attributes of the <cite>QuarterMaster</cite>. Only <cite>get_plugin</cite> and <cite>list_plugins</cite> are meant for users, the others are building blocks.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="api/theape.plugins.quartermaster.QuarterMaster.html#theape.plugins.quartermaster.QuarterMaster" title="theape.plugins.quartermaster.QuarterMaster"><tt class="xref py py-obj docutils literal"><span class="pre">QuarterMaster</span></tt></a>([external_modules])</td>
<td>A plugin manager</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/theape.plugins.quartermaster.QuarterMaster.list_plugins.html#theape.plugins.quartermaster.QuarterMaster.list_plugins" title="theape.plugins.quartermaster.QuarterMaster.list_plugins"><tt class="xref py py-obj docutils literal"><span class="pre">QuarterMaster.list_plugins</span></tt></a>()</td>
<td>Prints the names of the plugins to standard out</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="api/theape.plugins.quartermaster.QuarterMaster.plugins.html#theape.plugins.quartermaster.QuarterMaster.plugins" title="theape.plugins.quartermaster.QuarterMaster.plugins"><tt class="xref py py-obj docutils literal"><span class="pre">QuarterMaster.plugins</span></tt></a></td>
<td>A dictionary of plugins (this is persistent, unlike the generators, in case it gets re-used)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="api/theape.plugins.quartermaster.QuarterMaster.get_plugin.html#theape.plugins.quartermaster.QuarterMaster.get_plugin" title="theape.plugins.quartermaster.QuarterMaster.get_plugin"><tt class="xref py py-obj docutils literal"><span class="pre">QuarterMaster.get_plugin</span></tt></a>(name)</td>
<td>Retrieves a plugin object.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="auto-generated-diagrams">
<h2>Auto-Generated Diagrams<a class="headerlink" href="#auto-generated-diagrams" title="Permalink to this headline">¶</a></h2>
<p>These are auto-generated so they will always be more up-to-date than the previous class-diagrams, but they tend to be harder to read as well (and are just not pretty) so I will leave both in.</p>
</div>
<div class="section" id="some-messy-business">
<h2>Some Messy Business<a class="headerlink" href="#some-messy-business" title="Permalink to this headline">¶</a></h2>
<p>Since I am running code to create this documentation I am going to keep it from executing when it is not being compiled as documentation by setting up a flag. It is ugly, but I do not know how to exclude code from the tangling:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">document_this</span> <span class="o">=</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__builtin__&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>One of the purposes of the QuarterMaster is to find plugins for the rest of the code to use or to list them for the user. I had previously tried three methods to do something similar to this:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Explicit Imports</li>
<li>Naming Conventions</li>
<li><a class="reference external" href="http://yapsy.sourceforge.net/">yapsy</a></li>
</ol>
</div></blockquote>
<p>For the explicit imports I created a class and added properties that would import and return the class definitions, something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ImportClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_aoeu</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aoeu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aoeou</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">aoeu</span> <span class="kn">import</span> <span class="n">Aoeu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_aoeu</span> <span class="o">=</span> <span class="n">Aoeu</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aoeu</span>
</pre></div>
</div>
<p>The reason for the use of properties was so that if a specific class wasn&#8217;t needed it wouldn&#8217;t be imported. This worked okay as a quick hack, but as the classes piled up it quickly became too large (and it is just too inelegant). My attempt at using naming conventions (having all modules and classes have the same suffix) seemed too inflexible and clumsy. Yapsy seems like it would work, but having to dig through the API and do experiments to figure out how to get it working was proving to be too much work for the limited use I wanted out of it. So my solution here is to use the python standard library and a common base-class to create a primitive self-discovering plugin manager (the <cite>QuarterMaster</cite>). It will do file-discovery within the plugins directory to find candidate files, import their contents, then check to see which ones inherit from the <a class="reference internal" href="base_plugin.html#base-plugin"><em>BasePlugin</em></a>.</p>
<div class="section" id="gathering-files">
<h3>Gathering Files<a class="headerlink" href="#gathering-files" title="Permalink to this headline">¶</a></h3>
<p>The first step is to gather the file-names of potential plugins. Potential plugins in this case are python files in the same directory as the QuarterMaster. To illustrate the next examples I am going to use the <tt class="docutils literal"><span class="pre">base_plugin</span></tt> module since it is in the same directory and I need a file I can import.</p>
<p>The <a class="reference external" href="http://docs.python.org/2/library/os.html#files-and-directories">os.listdir</a> function takes a path string and returns a list of entries in the directory in arbitrary order (other than hidden directories). So we need the path to the <tt class="docutils literal"><span class="pre">plugins</span></tt> directory. In this case I am putting the <cite>QuarterMaster</cite> in the same directory so it is a matter of the QuarterMaster knowing its own directory. If you look at the <a class="reference external" href="http://docs.python.org/2/reference/simple_stmts.html#import">import</a> statement you will see that whenever a module is imported, it gets a <cite>__file__</cite> variable added to its namespace:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference external" href="http://docs.python.org/library/os.html#os.listdir" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">os.listdir</span></tt></a>((path)&nbsp;-&gt;&nbsp;list_of_strings)</td>
<td>Return a list containing the names of the entries in the directory.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../infrastructure/api/os.path.dirname.html#os.path.dirname" title="os.path.dirname"><tt class="xref py py-obj docutils literal"><span class="pre">os.path.dirname</span></tt></a>(p)</td>
<td>Returns the directory component of a pathname</td>
</tr>
</tbody>
</table>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">document_this</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">theape.plugins.base_plugin</span> <span class="kn">as</span> <span class="nn">base_plugin</span>
    <span class="k">print</span><span class="p">(</span><span class="n">base_plugin</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
</pre></div>
</div>
<div class="code highlight-python"><div class="highlight"><pre>/home/charon/repositories/code/hortators/theape/theape/plugins/base_plugin.pyc
</pre></div>
</div>
<p>Looking at the output you can see that the <tt class="docutils literal"><span class="pre">__file__</span></tt> contains the path to the compiled bytecode of the module. To get the <cite>path</cite> we want for the <tt class="docutils literal"><span class="pre">listdir</span></tt> function we can use <a class="reference external" href="http://docs.python.org/2/library/os.path.html#module-os.path">os.path.dirname</a> which takes a path and returns the directory without the file-name. So, with these three elements, and the fact that python files have the <cite>.py</cite> extension, we can find all the files in the same directory as that of a particular module:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">document_this</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">base_plugin</span><span class="o">.</span><span class="n">__file__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="code highlight-python"><div class="highlight"><pre><span class="n">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">apeplugin</span><span class="o">.</span><span class="n">py</span>
<span class="n">base_plugin</span><span class="o">.</span><span class="n">py</span>
<span class="n">compositeplugin</span><span class="o">.</span><span class="n">py</span>
<span class="n">dummyplugin</span><span class="o">.</span><span class="n">py</span>
<span class="n">quartermaster</span><span class="o">.</span><span class="n">py</span>
<span class="n">sleep_plugin</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>I should point out, since it might not be obvious, that the classes within a module get the <tt class="docutils literal"><span class="pre">__file__</span></tt> variable added to their namespace as a global variable so the QuarterMaster can just use the <tt class="docutils literal"><span class="pre">__file__</span></tt> variable directly without importing anything (so in the QuarterMaster you will see <tt class="docutils literal"><span class="pre">__file__</span></tt>, not <tt class="docutils literal"><span class="pre">base_plugin.__file__</span></tt>) but the code I run while documenting this module cannot get access to it without referring to an imported module. I think it has to do with the fact that the import statement is what creates the variable so if this module were imported it would be created, but to generate the document, I run it through Pweave. Just keep that in mind if you look at the code.</p>
<p>Anyway, did that work? Yes and no. Notice that it only printed out file-names, not the whole path. If we use this as the base for importing (after removing the extension) it will work for this documentation because I have to compile it while in the same directory, but the moment you run the code anywhere else python will raise an error (unless you happen to be in a directory with files of the same name). So do we just add the paths? That was my first notion, but this will raise an error when you try to import it. It  looks like <tt class="docutils literal"><span class="pre">importlib</span></tt> is importing a file, but the name you are passing in is actually the name of the module, not the file. This can be confusing but it just means that instead of the file-path, you need to refer to the module the way you would when you import it, using dot-notation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">theape.plugins.apeplugin</span>
</pre></div>
</div>
<p>So how do we get this? Well, it turns out that import creates another variable in a module-namespace called <tt class="docutils literal"><span class="pre">__package__</span></tt> which contains the dotted-notation path to the package where the module is located. This was confusing to me at first (and I may still be wrong), but basically packages correspond to directories and modules correspond to files, but they are <em>not</em> files and directories and they are not referred to in the same way that the file-system would refer to them. The file-names still have their extensions so I will add the package prefix later, but this is what is in the <tt class="docutils literal"><span class="pre">__package__</span></tt>:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">document_this</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">base_plugin</span><span class="o">.</span><span class="n">__package__</span><span class="p">)</span>
</pre></div>
</div>
<div class="code highlight-python"><div class="highlight"><pre><span class="n">theape</span><span class="o">.</span><span class="n">plugins</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-the-plugins">
<h3>Finding the Plugins<a class="headerlink" href="#finding-the-plugins" title="Permalink to this headline">¶</a></h3>
<p>To figure out if something in a file we have discovered is a Plugin we need to know that it is a child of the <tt class="docutils literal"><span class="pre">BasePlugin</span></tt>. To do that we need to import it then check that its <tt class="docutils literal"><span class="pre">__base__</span></tt> property is the <tt class="docutils literal"><span class="pre">BasePlugin</span></tt>. What we created previously was a list of strings (file-names), the next step is to get rid of the file extension using <tt class="docutils literal"><span class="pre">os.path.splitext</span></tt> (which returns a (basename, extension) tuple created from a file name) and import those basenames using the <a class="reference external" href="http://docs.python.org/2/library/importlib.html">importlib</a> module.</p>
<p>Besides filtering on the extension, I am also going to exclude some other files because importing them executes all the code in them and I am getting extraneous strings appearing in the output for this documentation. Also, once the extension is removed from the name I prepend the package. The import module says that it takes the package name as an argument, but that uses relative importing so there would be some dot-notation to figure out. This seems easier.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="../documentation/developer/explorations/explore_importlib/api/importlib.import_module.html#importlib.import_module" title="importlib.import_module"><tt class="xref py py-obj docutils literal"><span class="pre">importlib.import_module</span></tt></a>(name[,&nbsp;package])</td>
<td>Import a module.</td>
</tr>
</tbody>
</table>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">document_this</span><span class="p">:</span>
    <span class="c"># remember we need the package</span>
    <span class="n">package</span> <span class="o">=</span> <span class="n">base_plugin</span><span class="o">.</span><span class="n">__package__</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="s">&quot;__init__.py index.py constants.py quartermaster.py&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                   <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>
    <span class="n">basenames_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
    <span class="n">modules</span> <span class="o">=</span> <span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">package</span><span class="p">,</span> <span class="n">base</span><span class="p">)))</span> <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">basenames_extensions</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point there is nothing really interesting to print yet &#8211; we need to find the things in the modules that are plugins. To get the objects in the modules we can use the <a class="reference external" href="http://docs.python.org/2/library/inspect.html#inspect.getmembers">inspect.getmembers</a> function. Once we have them, we can check the <tt class="docutils literal"><span class="pre">__base__</span></tt> variable that each class has which holds the parent class. Only classes have the <tt class="docutils literal"><span class="pre">__base__</span></tt> attribute so we will also filter non-classes out using the <a class="reference external" href="http://docs.python.org/2/library/inspect.html#inspect.getmembers">inspect.isclass</a> function to prevent AttributeErrors.</p>
<p>The signature of the <tt class="docutils literal"><span class="pre">getmembers</span></tt> function is this:</p>
<div class="highlight-python"><div class="highlight"><pre>inspect.getmembers(object[, predicate])
</pre></div>
</div>
<p>The <cite>predicate</cite> argument is an optional function that you pass in to filter what <tt class="docutils literal"><span class="pre">getmembers</span></tt> returns. <tt class="docutils literal"><span class="pre">getmembers</span></tt> will only return objects that evaluate to True when passed to the predicate function, so if we pass in a function that checks if an object is the child of the BasePlugin, this should give us our plugins:</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference external" href="http://docs.python.org/library/inspect.html#inspect.isclass" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">inspect.isclass</span></tt></a>(object)</td>
<td>Return true if the object is a class.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="../infrastructure/api/inspect.getmembers.html#inspect.getmembers" title="inspect.getmembers"><tt class="xref py py-obj docutils literal"><span class="pre">inspect.getmembers</span></tt></a>(object[,&nbsp;predicate])</td>
<td>Return all members of an object as (name, value) pairs sorted by name.</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It looks like importing python-standard-library classes will not give them a <tt class="docutils literal"><span class="pre">__base__</span></tt> attribute so the <tt class="docutils literal"><span class="pre">is_plugin</span></tt> has to trap for <tt class="docutils literal"><span class="pre">AttributeError</span></tt> exceptions or any python file that imports a python standard library module has to be excluded from the files that are imported.</p>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">document_this</span><span class="p">:</span>
    <span class="n">isclass</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span>
    <span class="k">def</span> <span class="nf">is_plugin</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">isclass</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">__base__</span> <span class="ow">is</span> <span class="n">BasePlugin</span>

    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
        <span class="n">members</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">module</span><span class="p">,</span>
                                     <span class="n">predicate</span><span class="o">=</span><span class="n">is_plugin</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="c"># each member is a tuple</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">definition</span> <span class="o">=</span> <span class="n">member</span>
            <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">plugin</span> <span class="o">=</span> <span class="n">definition</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Oops. What happened there (the <tt class="docutils literal"><span class="pre">print</span></tt> statement should have created some output above this paragraph)? Well, it turns out that now that we are using the full import path, we need to add the full path for <tt class="docutils literal"><span class="pre">BasePlugin</span></tt> when we do our check or it will fail.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference external" href="http://docs.python.org/library/os.path.html#os.path.splitext" title="(in Python v2.7)"><tt class="xref py py-obj docutils literal"><span class="pre">os.path.splitext</span></tt></a>(p)</td>
<td>Split the extension from a pathname.</td>
</tr>
</tbody>
</table>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">document_this</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">theape.plugins.base_plugin</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                   <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.py&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">)</span>
    <span class="n">basenames_extensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">)</span>
    <span class="n">modules</span> <span class="o">=</span> <span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">package</span><span class="p">,</span> <span class="n">base</span><span class="p">)))</span> <span class="k">for</span> <span class="n">base</span><span class="p">,</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">basenames_extensions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_plugin</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">isclass</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">__base__</span> <span class="ow">is</span> <span class="n">theape</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">base_plugin</span><span class="o">.</span><span class="n">BasePlugin</span>

    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
        <span class="n">members</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">module</span><span class="p">,</span>
                                     <span class="n">predicate</span><span class="o">=</span><span class="n">is_plugin</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="c"># each member is a tuple</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">definition</span> <span class="o">=</span> <span class="n">member</span>
            <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">plugin</span> <span class="o">=</span> <span class="n">definition</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<div class="code highlight-python"><div class="highlight"><pre><span class="n">Ape</span>
<span class="n">Sleep</span>
<span class="n">CrashTestDummy</span>
<span class="n">Dummy</span>
<span class="n">StuckDummy</span>
<span class="n">Sleep</span>
</pre></div>
</div>
<p>The actual instantiation of the plugin (<tt class="docutils literal"><span class="pre">plugin</span> <span class="pre">=</span> <span class="pre">definition(None)</span></tt>) was done to show that it is a callable object (a Plugin class definition in this case).</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The QuarterMaster</a><ul>
<li><a class="reference internal" href="#public-methods-and-properties">Public Methods and Properties</a></li>
<li><a class="reference internal" href="#auto-generated-diagrams">Auto-Generated Diagrams</a></li>
<li><a class="reference internal" href="#some-messy-business">Some Messy Business</a></li>
<li><a class="reference internal" href="#background">Background</a><ul>
<li><a class="reference internal" href="#gathering-files">Gathering Files</a></li>
<li><a class="reference internal" href="#finding-the-plugins">Finding the Plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation/user/index.html">User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/developer/index.html">Developer Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../log_setter.html">Log Setter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main.html">The Main Entry Point</a></li>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">The APE (Read Me)</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">The Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infrastructure/index.html">The Ape&#8217;s Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parts/index.html">Parts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Plugins</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, the cloistered monkey.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.2</a>
      
      |
      <a href="../_sources/plugins/quartermaster.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>