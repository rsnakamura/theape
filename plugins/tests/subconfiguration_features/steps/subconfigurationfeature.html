<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SubConfiguration &mdash; The Ape 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.2.0/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="The Ape 0.0.1 documentation" href="../../../../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html">
          The Ape</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation/user/index.html">User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../documentation/developer/index.html">Developer Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../log_setter.html">Log Setter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../main.html">The Main Entry Point</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../readme.html">The APE (Read Me)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../components/index.html">The Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infrastructure/index.html">The Ape&#8217;s Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../parts/index.html">Parts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Plugins</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">SubConfiguration</a><ul>
<li><a class="reference internal" href="#scenario-user-instantiates-the-subconfiguration">Scenario: User instantiates the SubConfiguration</a></li>
<li><a class="reference internal" href="#scenario-user-instantiates-subconfiguration-implementation">Scenario: User instantiates SubConfiguration implementation</a></li>
<li><a class="reference internal" href="#scenario-configuration-passes">Scenario: Configuration passes</a></li>
<li><a class="reference internal" href="#scenario-option-fails-validation">Scenario: Option fails validation</a></li>
<li><a class="reference internal" href="#scenario-missing-option">Scenario: Missing Option</a></li>
<li><a class="reference internal" href="#scenario-missing-section">Scenario: Missing Section</a></li>
<li><a class="reference internal" href="#scenario-configspec-section-name-format">Scenario: ConfigSpec Section Name Format</a></li>
<li><a class="reference internal" href="#scenario-configspec-string-only-has-sub-section-definition">Scenario: ConfigSpec string only has sub-section definition</a></li>
<li><a class="reference internal" href="#scenario-configuration-has-extra-values">Scenario: Configuration has extra values</a></li>
<li><a class="reference internal" href="#scenario-configuration-has-no-extra-values">Scenario: Configuration has no extra values</a></li>
<li><a class="reference internal" href="#scenario-section-updates-configuration">Scenario: Section updates configuration</a></li>
<li><a class="reference internal" href="#scenario-configuration-missing-plugin-name">Scenario: Configuration missing plugin name</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../../../_sources/plugins/tests/subconfiguration_features/steps/subconfigurationfeature.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="subconfiguration">
<h1>SubConfiguration<a class="headerlink" href="#subconfiguration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="scenario-user-instantiates-the-subconfiguration">
<h2>Scenario: User instantiates the SubConfiguration<a class="headerlink" href="#scenario-user-instantiates-the-subconfiguration" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration definition&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">base_configuration_definition</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">SubConfiguration</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the user instantiates the SubConfiguration&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">base_configuration_instantiation</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">callable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="n">context</span><span class="o">.</span><span class="n">definition</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;it raises a TypeError&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">assert_raises</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">calling</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">callable</span><span class="p">),</span>
                <span class="n">raises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-user-instantiates-subconfiguration-implementation">
<h2>Scenario: User instantiates SubConfiguration implementation<a class="headerlink" href="#scenario-user-instantiates-subconfiguration-implementation" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">configspec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">plugin = option(Fake)</span>

<span class="s">op = string</span>
<span class="s">op2 = integer</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">FakeConfiguration</span><span class="p">(</span><span class="n">SubConfiguration</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FakeConfiguration</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">configspec_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec_source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configspec_source</span> <span class="o">=</span> <span class="n">configspec</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configspec_source</span>

<span class="n">config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">op = value</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration implementation&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">base_configuration_implementation</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">ConfigObj</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">implementation</span> <span class="o">=</span> <span class="n">FakeConfiguration</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configspec_source</span> <span class="o">=</span> <span class="n">configspec</span>
    <span class="n">context</span><span class="o">.</span><span class="n">section_name</span> <span class="o">=</span> <span class="s">&#39;FAKE&#39;</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the user instantiates the SubConfiguration implementation&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">base_configuration_implementation_instantiation</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">implementation</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="p">,</span>
                                                   <span class="n">section_name</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">section_name</span><span class="p">,</span>
                                                   <span class="n">configspec_source</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">configspec_source</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;it has the SubConfiguration default properties&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">assert_default_properties</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">configuration</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="n">instance_of</span><span class="p">(</span><span class="n">ConfigObj</span><span class="p">)))</span>

    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">configspec</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="n">instance_of</span><span class="p">(</span><span class="n">ConfigObj</span><span class="p">)))</span>

    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">validator</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="n">instance_of</span><span class="p">(</span><span class="n">Validator</span><span class="p">)))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-configuration-passes">
<h2>Scenario: Configuration passes<a class="headerlink" href="#scenario-configuration-passes" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">valid_config_string</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[GOODBUTFAKE]</span>
<span class="s">plugin = Fake</span>

<span class="s">op = some value</span>
<span class="s">op2 = 75</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration implementation with valid configuration&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_configuration</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">valid_config_string</span><span class="p">),</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;GOODBUTFAKE&#39;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>When the SubConfiguration implementation processes the errors</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the process_errors outcome was False&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_errors_false</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="bp">False</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-option-fails-validation">
<h2>Scenario: Option fails validation<a class="headerlink" href="#scenario-option-fails-validation" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">bad_option_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">plugin = Fake</span>

<span class="s">op = value</span>
<span class="s">op2 = not_integer</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration implementation with a bad option&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bad_option</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
    <span class="n">bad_option_message</span> <span class="o">=</span> <span class="n">SubConfigurationConstants</span><span class="o">.</span><span class="n">bad_option_message</span>
    <span class="n">context</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">RED_ERROR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="s">&#39;ConfigurationError&#39;</span><span class="p">,</span>
                                        <span class="n">message</span><span class="o">=</span><span class="n">bad_option_message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="s">&#39;op2&#39;</span><span class="p">,</span>
                                                                          <span class="n">section</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">,</span>
                                                                          <span class="n">error</span><span class="o">=</span><span class="s">&#39;the value &quot;not_integer&quot; is of the wrong type.&#39;</span><span class="p">,</span>
                                                                          <span class="n">option_type</span><span class="o">=</span><span class="s">&#39;integer&#39;</span><span class="p">))</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">bad_option_config</span><span class="p">),</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">logger</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the SubConfiguration implementation processes the errors&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_errors</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">outcome</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">validator</span><span class="p">,</span>
                                                           <span class="n">preserve_errors</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">outcome</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">process_errors</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the correct error message is logged&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_error_message</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">expected</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the process_errors outcome was True&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_errors_true</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-missing-option">
<h2>Scenario: Missing Option<a class="headerlink" href="#scenario-missing-option" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">missing_option_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">plugin = Fake</span>

<span class="s">op = value</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration implementation with a missing option&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">missing_option</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
    <span class="n">missing_option_message</span> <span class="o">=</span> <span class="n">SubConfigurationConstants</span><span class="o">.</span><span class="n">missing_option_message</span>
    <span class="n">context</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">RED_ERROR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="s">&#39;ConfigurationError&#39;</span><span class="p">,</span>
                                        <span class="n">message</span><span class="o">=</span><span class="n">missing_option_message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="s">&#39;op2&#39;</span><span class="p">,</span>
                                                                            <span class="n">section</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">,</span>
                                                                            <span class="n">plugin</span><span class="o">=</span><span class="s">&#39;Fake&#39;</span><span class="p">,</span>
                                                                            <span class="n">option_type</span><span class="o">=</span><span class="s">&#39;integer&#39;</span><span class="p">))</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">missing_option_config</span><span class="p">),</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">logger</span>

    <span class="k">return</span>
</pre></div>
</div>
<dl class="docutils">
<dt>When the SubConfiguration implementation processes the errors,</dt>
<dd>Then the correct error message is logged</dd>
</dl>
</div>
<div class="section" id="scenario-missing-section">
<h2>Scenario: Missing Section<a class="headerlink" href="#scenario-missing-section" title="Permalink to this headline">¶</a></h2>
<p>Because the operators are expecting arbitrary section-names this last errors will only occur if the plugin has defined sub-section names in the configspec (I think).</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># so the configspect can&#39;t have the top-level section name</span>
<span class="n">subsection_configspec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">plugin = string</span>

<span class="s">[sub_section]</span>
<span class="s">op1 = integer</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="n">missing_section_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">plugin = fake_plugin</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration implementation missing the section&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">missing_section</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
    <span class="n">missing_section_message</span> <span class="o">=</span> <span class="n">SubConfigurationConstants</span><span class="o">.</span><span class="n">missing_section_message</span>
    <span class="n">context</span><span class="o">.</span><span class="n">expected</span> <span class="o">=</span> <span class="n">RED_ERROR</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error</span><span class="o">=</span><span class="s">&#39;ConfigurationError&#39;</span><span class="p">,</span>
                                        <span class="n">message</span><span class="o">=</span><span class="n">missing_section_message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="s">&#39;FAKE,sub_section&#39;</span><span class="p">,</span>
                                                                            <span class="n">error</span><span class="o">=</span><span class="s">&#39;missing section&#39;</span><span class="p">,</span>
                                                                            <span class="n">plugin</span><span class="o">=</span><span class="s">&#39;fake_plugin&#39;</span><span class="p">))</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">missing_section_config</span><span class="p">),</span>
                                              <span class="n">configspec_source</span><span class="o">=</span><span class="n">subsection_configspec</span><span class="p">,</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">logger</span>
    <span class="k">return</span>
</pre></div>
</div>
<dl class="docutils">
<dt>When the SubConfiguration implementation processes the errors,</dt>
<dd>Then the correct error message is logged</dd>
</dl>
</div>
<div class="section" id="scenario-configspec-section-name-format">
<h2>Scenario: ConfigSpec Section Name Format<a class="headerlink" href="#scenario-configspec-section-name-format" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">section_name_configspec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">op1 = integer</span>

<span class="s">[sub_section]</span>
<span class="s">op2 = integer</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">section_name_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">op1 = 1</span>

<span class="s">[[sub_section]]</span>
<span class="s">op2 = 1</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration configspec with section_name&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">configspec_section_name</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">section_name_config</span><span class="p">),</span>
                                              <span class="n">configspec_source</span><span class="o">=</span><span class="n">section_name_configspec</span><span class="p">,</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the SubConfiguration implementation is checked&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_implementation</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">process_errors</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the configuration outcome is True&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">assert_outcome_true</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">validation_outcome</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-configspec-string-only-has-sub-section-definition">
<h2>Scenario: ConfigSpec string only has sub-section definition<a class="headerlink" href="#scenario-configspec-string-only-has-sub-section-definition" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre> subsection_only_configspec = &quot;&quot;&quot;
 op1 = integer

 [sub_section]
 op2 = integer
 &quot;&quot;&quot;
 @given(&quot;a SubConfiguration configspec without top-section&quot;)
 def configspec_subsection(context):
     context.configuration = FakeConfiguration(source=ConfigObj(section_name_config),
                                               configspec_source=section_name_configspec,
                                               section_name=&#39;FAKE&#39;)
     context.configuration._logger = MagicMock()

     return


when the SubConfiguration implementation is checked
Then the configuration outcome is True
</pre></div>
</div>
</div>
<div class="section" id="scenario-configuration-has-extra-values">
<h2>Scenario: Configuration has extra values<a class="headerlink" href="#scenario-configuration-has-extra-values" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">extra_options_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">op1 = 1</span>

<span class="s">[[sub_section]]</span>
<span class="s">op2 = 5</span>
<span class="s">op7 = 0</span>

<span class="s">[FAKE2]</span>
<span class="s">op1 = 3</span>

<span class="s">[[sub_section]]</span>
<span class="s">op2 = 4</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration config with options not in the configspec&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">extra_options</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">extra_options_config</span><span class="p">),</span>
                                              <span class="n">configspec_source</span><span class="o">=</span><span class="n">section_name_configspec</span><span class="p">,</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">logger</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the SubConfiguration implementation checks extra values&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_extra_values</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">outcome</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">check_extra_values</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the extra values are logged&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">extra_values_logged</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">section</span> <span class="o">=</span> <span class="s">&#39;FAKE,sub_section&#39;</span>
    <span class="n">item_type</span> <span class="o">=</span> <span class="s">&#39;option&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;op7&#39;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">SubConfigurationConstants</span><span class="o">.</span><span class="n">extra_message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">section</span><span class="o">=</span><span class="n">section</span><span class="p">,</span>
                                                              <span class="n">item_type</span><span class="o">=</span><span class="n">item_type</span><span class="p">,</span>
                                                              <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;=&#39;0&#39;&quot;</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">assert_called_with</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&#39;check_extra_value returns True&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">assert_extra_values</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-configuration-has-no-extra-values">
<h2>Scenario: Configuration has no extra values<a class="headerlink" href="#scenario-configuration-has-no-extra-values" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre>  no_extra_options_config = &quot;&quot;&quot;
  [FAKE]
  op1 = 1

  [[sub_section]]
  op2 = 5
  &quot;&quot;&quot;.splitlines()

  @given(&quot;a SubConfiguration config with no options not in the configspec&quot;)
  def no_extra_options(context):
      context.logger = MagicMock()
      context.logger.warning = MagicMock()
      context.configuration = FakeConfiguration(source=ConfigObj(no_extra_options_config),
                                                configspec_source=section_name_configspec,
                                                section_name=&#39;FAKE&#39;)
      context.configuration._logger = context.logger

      return



When the SubConfiguration implementation checks extra values
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;no extra values are logged&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">no_logging</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="n">equal_to</span><span class="p">([])))</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&#39;check_extra_value returns False&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_extra_false</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span>
                <span class="n">is_</span><span class="p">(</span><span class="bp">False</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-section-updates-configuration">
<h2>Scenario: Section updates configuration<a class="headerlink" href="#scenario-section-updates-configuration" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">update_sections_configspec</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">updates_section = string(default=None)</span>
<span class="s">op1 = integer</span>

<span class="s">[sub_section]</span>
<span class="s">op2 = integer</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">update_sections_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">op1 = 1</span>

<span class="s">[[sub_section]]</span>
<span class="s">op2 = 5</span>

<span class="s">[FAKE2]</span>
<span class="s">updates_section = FAKE</span>

<span class="s">[[sub_section]]</span>
<span class="s">op2 = 2</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration section that updates another section&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">updates_section</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fake1</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">update_sections_config</span><span class="p">),</span>
                                              <span class="n">configspec_source</span><span class="o">=</span><span class="n">update_sections_configspec</span><span class="p">,</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fake2</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">update_sections_config</span><span class="p">),</span>
                                              <span class="n">configspec_source</span><span class="o">=</span><span class="n">update_sections_configspec</span><span class="p">,</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE2&#39;</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fake1</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">logger</span>
    <span class="n">context</span><span class="o">.</span><span class="n">fake2</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">logger</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the SubConfiguration implementation validates the configuration&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_configuration</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the SubConfiguration implementation will have the updates&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_updates</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="c">#import pudb; pudb.set_trace()</span>
    <span class="n">expected_fake</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;op1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s">&#39;sub_section&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;op2&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}}</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">fake1</span><span class="o">.</span><span class="n">configuration</span><span class="p">,</span>
                <span class="n">has_entries</span><span class="p">(</span><span class="n">expected_fake</span><span class="p">))</span>

    <span class="n">expected_fake2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;op1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s">&#39;sub_section&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;op2&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}}</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">fake2</span><span class="o">.</span><span class="n">configuration</span><span class="p">,</span>
                <span class="n">has_entries</span><span class="p">(</span><span class="n">expected_fake2</span><span class="p">))</span>

    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="scenario-configuration-missing-plugin-name">
<h2>Scenario: Configuration missing plugin name<a class="headerlink" href="#scenario-configuration-missing-plugin-name" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">missing_plugin_name_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">[FAKE]</span>
<span class="s">op = some string</span>
<span class="s">op2 = 42</span>
<span class="s">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

<span class="nd">@given</span><span class="p">(</span><span class="s">&quot;a SubConfiguration section missing a required plugin name&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">missing_plugin_name</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">FakeConfiguration</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">ConfigObj</span><span class="p">(</span><span class="n">missing_plugin_name_config</span><span class="p">),</span>
                                              <span class="n">section_name</span><span class="o">=</span><span class="s">&#39;FAKE&#39;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@when</span><span class="p">(</span><span class="s">&quot;the SubConfiguration checks process_errors&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check_process_errors</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">context</span><span class="o">.</span><span class="n">callable</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">process_errors</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the process_errors returned True&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">process_errors_true</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">calling</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">callable</span><span class="p">),</span>
                <span class="n">raises</span><span class="p">(</span><span class="n">ConfigurationError</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@then</span><span class="p">(</span><span class="s">&quot;the configuration options that were given are in the configuration&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">assert_options</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;op&#39;</span><span class="p">:</span><span class="s">&#39;some string&#39;</span><span class="p">,</span>
                <span class="s">&#39;op2&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
    <span class="n">assert_that</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">configuration</span><span class="p">,</span>
                <span class="n">has_entries</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, the cloistered monkey.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>